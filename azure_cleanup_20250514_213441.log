2025-05-14 21:34:41 - Starting Azure resource cleanup...
2025-05-14 21:34:41 - Running in automatic mode.
2025-05-14 21:34:41 - Excluded resource groups: NetworkWatcherRG cloud-shell-storage-westeurope cloud-shell-storage-* AzureBackupRG_* DefaultResourceGroup-*
2025-05-14 21:34:41 - Step 1: Discovering all resource groups...
2025-05-14 21:34:41 - Found 4 resource groups in total.
2025-05-14 21:34:41 - Step 2: Filtering resource groups to delete...
2025-05-14 21:34:41 - Excluding resource group: cloud-shell-storage-westeurope (matches pattern cloud-shell-storage-westeurope)
2025-05-14 21:34:41 - Excluding resource group: NetworkWatcherRG (matches pattern NetworkWatcherRG)
2025-05-14 21:34:41 - Adding resource group for cleanup: web-resource-group
2025-05-14 21:34:41 - Excluding resource group: AzureBackupRG_polandcentral_1 (matches pattern AzureBackupRG_*)
2025-05-14 21:34:41 - Found 1 resource groups to clean up.
2025-05-14 21:34:41 - Step 3: Removing resource locks...
2025-05-14 21:34:41 - Checking for locks in resource group: web-resource-group
2025-05-14 21:34:42 - Checking for subscription-level locks...
2025-05-14 21:34:42 - Step 4: Special handling for Recovery Services vaults...
2025-05-14 21:34:42 - Checking for Recovery Services vaults in resource group: web-resource-group
2025-05-14 21:34:43 - Found Recovery Services vault: vault473 in resource group: web-resource-group
2025-05-14 21:34:43 - Disabling soft delete for vault: vault473
2025-05-14 21:34:47 - Checking for protected backup items in vault: vault473
2025-05-14 21:34:48 - Processing container: IaasVMContainer;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:34:50 - Attempting to undelete item: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:34:52 - Undelete not required or failed for: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:35:12 - Disabling protection for item: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:35:15 - Failed to disable protection for item: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:35:45 - Attempting to undelete item: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:35:47 - Undelete not required or failed for: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:36:07 - Disabling protection for item: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:36:09 - Failed to disable protection for item: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:36:39 - Processing container: IaasVMContainer;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:36:41 - Attempting to undelete item: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:36:43 - Undelete not required or failed for: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:37:03 - Disabling protection for item: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:37:05 - Failed to disable protection for item: VM;iaasvmcontainerv2;FOODSHARE-RESOURCE-GROUP;foodshare-virtual-machine
2025-05-14 21:37:35 - Attempting to undelete item: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:37:37 - Undelete not required or failed for: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:37:57 - Disabling protection for item: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:38:01 - Failed to disable protection for item: VM;iaasvmcontainerv2;web-resource-group;web-virtual-machine
2025-05-14 21:38:31 - Attempting to delete vault: vault473 after cleanup
2025-05-14 21:38:37 - Failed to delete vault: vault473 - manual intervention may be required
2025-05-14 21:38:37 - Step 5: Finding and deallocating all VMs...
2025-05-14 21:38:37 - Checking for VMs in resource group: web-resource-group
2025-05-14 21:38:38 - No VMs found in resource group: web-resource-group
2025-05-14 21:38:38 - Waiting for VM deallocations to complete...
2025-05-14 21:39:38 - Step 6: Deleting resource groups...
2025-05-14 21:39:39 - Deleting resource group: web-resource-group
2025-05-14 21:39:44 - Waiting for resource group deletions to complete...
2025-05-14 21:39:45 - All resource group deletions completed!
2025-05-14 21:39:45 - Step 7: Verifying remaining resource groups...
2025-05-14 21:39:45 - Remaining resource groups:
Name                            Status
------------------------------  ---------
cloud-shell-storage-westeurope  Succeeded
NetworkWatcherRG                Succeeded
web-resource-group              Deleting
AzureBackupRG_polandcentral_1   Succeeded
2025-05-14 21:39:45 - Step 8: Final verification of resource cleanup...
2025-05-14 21:39:45 - Checking for any remaining resources in non-excluded resource groups...
2025-05-14 21:39:47 - Remaining resources (excluding excluded resource groups):
Name                                                       Location       CreatedTime                       ChangedTime                       ProvisioningState    ResourceGroup
---------------------------------------------------------  -------------  --------------------------------  --------------------------------  -------------------  -----------------------------
AzureBackup_web-virtual-machine_7971723185939630122        polandcentral  2023-07-16T18:30:50.825701+00:00  2023-07-16T18:40:51.413473+00:00  Succeeded            AzureBackupRG_polandcentral_1
AzureBackup_foodshare-virtual-machine_7971723185351554625  polandcentral  2023-07-16T18:35:03.162409+00:00  2023-07-16T18:45:03.432841+00:00  Succeeded            AzureBackupRG_polandcentral_1
vault473                                                   polandcentral  2023-07-16T18:28:35.005992+00:00  2025-05-15T04:18:37.232999+00:00  Succeeded            WEB-RESOURCE-GROUP
2025-05-14 21:39:47 - Cleanup process completed. Check the log file for details: azure_cleanup_20250514_213441.log
